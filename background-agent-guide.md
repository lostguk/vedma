# Background Agent в Cursor: Полное руководство

## Что такое Background Agent?

**Background Agent** — это революционная функция в Cursor, которая позволяет запускать AI-агентов асинхронно в облачной среде. В отличие от обычного агента, который работает локально и требует постоянного взаимодействия, Background Agent работает полностью автономно в изолированной облачной среде.

## Как работает Background Agent?

### Основные принципы работы:

1. **Облачное выполнение**: Агент запускается в изолированной виртуальной машине в AWS
2. **Автономная работа**: Может работать часами без вашего участия
3. **Полный доступ к среде**: Может устанавливать пакеты, выполнять команды, работать с файлами
4. **Интеграция с GitHub**: Автоматически создает ветки и pull request'ы
5. **Параллельное выполнение**: Можно запускать несколько агентов одновременно

### Архитектура:

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Cursor IDE    │    │   Cloud Agent   │    │     GitHub      │
│                 │    │                 │    │                 │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │   Prompt    │─┼────┼→│ Environment │ │    │ │    Repo     │ │
│ └─────────────┘ │    │ │   Setup     │ │    │ │   Clone     │ │
│                 │    │ └─────────────┘ │    │ └─────────────┘ │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │ Review      │←┼────┼─│   Code      │ │    │ │   Branch    │←│
│ │ Results     │ │    │ │ Execution   │ │    │ │  Creation   │ │
│ └─────────────┘ │    │ └─────────────┘ │    │ └─────────────┘ │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## Настройка и запуск

### Активация функции:

1. **Включение**: Settings → Beta → Background Agents
2. **Подключение GitHub**: Необходимы права read-write к репозиторию
3. **Настройка среды**: Создание снимка окружения
4. **Запуск агента**: Ctrl+E → создать нового агента

### Настройка среды (.cursor/environment.json):

```json
{
    "snapshot": "POPULATED_FROM_SETTINGS",
    "install": "npm install && composer install",
    "start": "sudo service docker start",
    "terminals": [
        {
            "name": "Laravel Dev Server",
            "command": "php artisan serve"
        },
        {
            "name": "Queue Worker",
            "command": "php artisan queue:work"
        }
    ]
}
```

### Команды жизненного цикла:

-   **install**: Команды установки зависимостей (выполняется при создании среды)
-   **start**: Команды запуска сервисов (выполняется при старте агента)
-   **terminals**: Фоновые процессы в tmux-сессиях

## Возможности Background Agent

### Что может делать:

✅ **Код и файлы**:

-   Создавать и редактировать файлы
-   Рефакторить кодовую базу
-   Исправлять баги
-   Реализовывать новые функции

✅ **Командная строка**:

-   Выполнять любые терминальные команды
-   Устанавливать пакеты и зависимости
-   Запускать тесты
-   Работать с Docker

✅ **Интеграция**:

-   Клонировать репозитории из GitHub
-   Создавать новые ветки
-   Делать коммиты и push
-   Создавать pull request'ы

✅ **Среда разработки**:

-   Запускать веб-серверы
-   Работать с базами данных
-   Компилировать код
-   Выполнять миграции

### Примеры задач:

```markdown
# Исправление UI багов

"Исправь проблему с адаптивностью на мобильных устройствах в компоненте Header"

# Реализация функций

"Создай API эндпоинт для получения списка заказов с фильтрацией и пагинацией"

# Рефакторинг

"Переведи все React компоненты с class-based на functional с хуками"

# Обновления зависимостей

"Обнови Laravel с версии 10 до 11 и исправь все breaking changes"
```

## Отличия от обычного агента

| Характеристика        | Обычный Agent               | Background Agent            |
| --------------------- | --------------------------- | --------------------------- |
| **Место выполнения**  | Локальная машина            | Облачная среда (AWS)        |
| **Время работы**      | Синхронно, требует ожидания | Асинхронно, работает в фоне |
| **Параллельность**    | Один агент за раз           | Множественные агенты        |
| **Доступ к командам** | Требует подтверждения       | Автоматическое выполнение   |
| **Интеграция с Git**  | Ручная работа с git         | Автоматические PR           |
| **Стоимость**         | Только токены модели        | Токены + облачные ресурсы   |
| **Безопасность**      | Локальная среда             | Изолированная VM            |
| **Доступ в интернет** | Через локальную сеть        | Полный доступ               |
| **Установка ПО**      | Невозможна                  | Полная свобода              |

### Подробнее об отличиях:

#### 🔄 **Режим работы**:

-   **Обычный**: Вопрос → ответ → действие → подтверждение
-   **Background**: Задача → автономная работа → результат

#### ⚡ **Скорость и эффективность**:

-   **Обычный**: Ограничен скоростью взаимодействия с пользователем
-   **Background**: Может работать часами без перерыва

#### 🛠 **Возможности среды**:

-   **Обычный**: Ограничен локальным окружением
-   **Background**: Чистая среда Ubuntu с возможностью установки любого ПО

#### 🔐 **Автономность команд**:

-   **Обычный**: `Выполнить команду 'npm install'? [Y/n]`
-   **Background**: Автоматически выполняет все необходимые команды

## Веб и мобильное приложение

### Доступ через браузер:

-   **URL**: cursor.com/agents
-   **Устройства**: Любой браузер (desktop, tablet, mobile)
-   **PWA**: Можно установить как приложение на iOS/Android

### Мобильные возможности:

-   📱 Запуск агентов с телефона
-   🔔 Push-уведомления о завершении задач
-   📄 Просмотр результатов и diff'ов
-   🔗 Создание и управление PR

### Slack интеграция:

```
@Cursor исправь баг с авторизацией в API
```

-   Запуск агентов из Slack
-   Уведомления о завершении
-   Совместная работа команды

## Стоимость и модели

### Ценообразование:

-   **Модели**: Только Max Mode (Claude 3.5 Sonnet, GPT-4, etc.)
-   **Вычисления**: Пока бесплатно (будет платно в будущем)
-   **Токены**: По обычным расценкам модели
-   **⚠️ Внимание**: Очень дорого из-за Max Mode!

### Рекомендации по использованию:

-   Используйте для серьезных задач, а не мелких правок
-   Мониторьте расход токенов
-   Начинайте с простых задач для тестирования

## Безопасность и конфиденциальность

### Меры безопасности:

-   ✅ Поддержка Privacy Mode
-   ✅ Изолированные VM для каждого агента
-   ✅ Шифрование данных at-rest через KMS
-   ⚠️ Автоматическое выполнение команд (риск инъекций)
-   ⚠️ Полный доступ к интернету

### Рекомендации:

1. **Не передавайте секреты** в промптах
2. **Проверяйте результаты** перед мержем
3. **Используйте Privacy Mode** для чувствительных проектов
4. **Ограничивайте права** GitHub приложения

## Практические советы

### 🎯 **Лучшие сценарии использования**:

-   Рефакторинг больших кодовых баз
-   Обновление зависимостей
-   Исправление множественных багов
-   Создание шаблонного кода
-   Написание тестов
-   Настройка CI/CD

### 🚫 **Не рекомендуется для**:

-   Мелких правок (дорого)
-   Критичных изменений без проверки
-   Работы с секретами
-   Экспериментов с неопределенным результатом

### 📝 **Советы по промптам**:

```markdown
# Хороший промпт

Создай RESTful API для управления задачами:

-   Модель Task с полями: title, description, status, due_date
-   CRUD операции с валидацией
-   Тесты для всех endpoints
-   Документация в Swagger
-   Используй Laravel 11 best practices

# Плохой промпт

Сделай что-то с задачами
```

## Будущее развития

### Планируемые функции:

-   🔄 Автомерж из Cursor (без GitHub)
-   🧠 Улучшенное понимание контекста
-   ⚔️ Разрешение конфликтов веток
-   🔗 Поддержка GitLab, BitBucket
-   💰 Гибкое ценообразование

### Текущие ограничения:

-   Только GitHub интеграция
-   Высокая стоимость
-   Риски автовыполнения команд
-   Требует тестирования в продакшене

## Заключение

Background Agent — это мощный инструмент, который кардинально меняет подход к разработке. Он позволяет делегировать сложные задачи AI и получать готовые решения, но требует осторожного использования из-за высокой стоимости и потенциальных рисков безопасности.

**Используйте для**: крупных задач, рефакторинга, автоматизации
**Не используйте для**: мелких правок, критичных изменений без проверки

---

_Создано как Background Agent руководство для разработчиков_
